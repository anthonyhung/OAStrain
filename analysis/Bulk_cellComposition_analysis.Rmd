---
title: "Bulk_cellComposition_analysis"
author: "Anthony Hung"
date: "2020-01-28"
output: workflowr::wflow_html
editor_options:
  chunk_output_type: console
---

# Cluster pilot Bulk RNA data with subset of cellAtlas bulk data and other data to determine where my samples fall in comparison

## Load data

```{r load}
library("RColorBrewer")
library("scales")
library("cowplot")
library("CountClust")
library("maptpx")
library("MAST")
library("ggplot2")
library("ggfortify")
library("gplots")

# load gene annotations
gene_anno <- read.delim("data/gene-annotation.txt",
                        sep = "\t")

# Load colors 
colors <- colorRampPalette(c(brewer.pal(9, "Blues")[1],brewer.pal(9, "Blues")[9]))(100)
pal <- c(brewer.pal(9, "Set1"), brewer.pal(8, "Set2"), brewer.pal(12, "Set3"))

#load cell atlas data matrix
load("data/cell_atlas_ref_panel")
cell.line <- cell.line[,c(12:20,35,36,40,55:57)]

#load pilot data
raw_counts <- as.matrix(readRDS("data/raw_counts_relabeled.rds"))

# load gene annotations
gene_anno <- read.delim("data/gene-annotation.txt",
                        sep = "\t")

#relabel pilot data genes to symbols
pilot <- raw_counts
rownames(pilot) <- gene_anno$external_gene_name[match(unlist(rownames(pilot)), gene_anno$ensembl_gene_id)]
```

## Before combining the datasets, I apply the same standardizations/normalizations performed on the cellAtlas data to my pilot data

```{r normalize}
#perform normalizations (taken from cellAtlas_assignment.R code)
pilot_norm <- apply(pilot, 2, function(x) x/sum(x))
pilot_libsize <- apply(pilot_norm, 2, function(x) x * 1e+06)
Data.use <- pilot_libsize

#Only include genes that are common between the two data sets
gene.id <- rownames(Data.use)
gene.ref <- rownames(cell.line)
common <- intersect(gene.id, gene.ref)
print(paste0("There are ", length(common), " genes in common between the two sets"))
logxx <- apply(Data.use[common, ], 2, function(x) {
        log(x + 0.1)
    })
selected.cell.line <- apply(cell.line[common, ], 2, function(x) {
        x - mean(x)
    })
```

## Combine the two datasets into one matrix

```{r combine}
combined <- cbind(logxx, selected.cell.line)
```

## Clustering (PCA)

```{r PCA cell atlas}
# Perform PCA
pca_genes <- prcomp(t(combined), scale = T)

#Make PCA plots 

autoplot(pca_genes, label = T)
```

## Clustering (corr heatmap)

```{r corr heatmap}
#Corr heatmap
cors <- cor(combined, method="spearman", use="pairwise.complete.obs")
heatmap.2(cors, scale="none", margins = c(12, 12), trace='none', denscol="white",
          cexCol = 0.1 + 1/log10(15), cexRow = 0.1 + 1/log10(15))
```


# Outside data analysis

Compare pilot bulk data with bulk data collected from iPSCs, MSCs, chondrocytes from OA patients, and heart tissue (note: I have only used a Single read from each sample and trimmed to the first 50 bases to ensure that there are not mapping biases between samples). Here, I try both upperquartile and RLE normalization methods

```{r load outside}
# load in counts
outside_data_counts <- read.table("/project2/gilad/anthonyhung/Projects/OAStrain_project/bulkRNAseq_outsideData/out/counts/counts.txt", header = T)

# assign row.names
row.names(outside_data_counts) <- outside_data_counts$Geneid

# exclude extra data columns
outside_data_counts <- outside_data_counts[, -c(1:6)]

#rename samples (colnames)
names(outside_data_counts) <- c("Heart_1_tr", "MSC.BM_nt_hBM1_tr", "Heart_4", "Chond_TCP_P1_2_tr",
                                "ChondOA_dmg_2", "ChondOA_intact_1", "Heart_1", "Heart_3_tr", 
                                "MSC.BM_nt_hBM3_tr", "ChondOA_intact_2", "MSC.BM_bm1", "iPSC-MSC5_H20157-d5-r1", 
                                "ChondOA_dmg_1", "Chond_SCM_P1_3", "Chond_TCP_P1_1_tr", "MSC.BM_nt_hBM2_tr", 
                                "MSC.BM_bm2", "Chond_SCM_P1_1", "ChondOA_intact_1_tr", "iPSC-MSC9_H20157-d9-r2", 
                                "Chond_SCM_P1_2_tr", "Chond_TCP_P1_1", "ChondOA_intact_3_tr", "ChondOA_dmg_2_tr",
                                "MSC.AD_hAD", "ChondOA_intact_3", "MSC.BM_nt_hBM2", "MSC.AD_hAD_tr", 
                                "ChondOA_dmg_1_tr", "ChondOA_intact_2_tr", "Heart_2_tr", "Heart_3", 
                                "MSC.BM_nt_hBM1", "Heart_4_tr", "Heart_2", "iPSC-MSC5_H20157-d5-r2", 
                                "ChondOA_dmg_3", "Chond_SCM_P1_3_tr", "Chond_SCM_P1_2", "ChondOA_dmg_3_tr", 
                                "MSC.BM_bm1_tr", "MSC.BM_nt_hBM3", "Chond_TCP_P1_3", "MSC.BM_bm2_tr",
                                "iPSC_H20157-d0-r1", "Chond_SCM_P1_1_tr", "iPSC-MSC9_H20157-d9-r1", "Chond_TCP_P1_3_tr",
                                "iPSC_H20157-d0-r2", "Chond_TCP_P1_2")

#Combine all bulk data together
merged_raw_data <- merge(raw_counts, outside_data_counts, by = "row.names")
row.names(merged_raw_data) <- merged_raw_data$Row.names
merged_raw_data <- merged_raw_data[,-1]

#Remove rows with all 0s
dim(merged_raw_data)
merged_raw_data <- merged_raw_data[apply(merged_raw_data, 1, function(x) !all(x==0)),]
dim(merged_raw_data)
```

## Raw counts analysis

```{r raw analysis}
# Perform PCA
pca_genes <- prcomp(t(data.matrix(merged_raw_data)), scale = T)

#Make PCA plots 
autoplot(pca_genes, label = T)


#Corr heatmap
cors <- cor(merged_raw_data, method="spearman", use="pairwise.complete.obs")

labels <- sapply(strsplit(colnames(merged_raw_data),"_"), `[`, 1)

heatmap.2( cors, scale="none", col = colors, margins = c(12, 12), trace='none', denscol="white", labCol=labels, ColSideColors=pal[as.integer(as.factor(labels))], RowSideColors=pal[as.integer(as.factor(labels))], cexCol = 0.2 + 1/log10(15), cexRow = 0.2 + 1/log10(15))
```

## Normalize raw merged counts: upperquartile Normalization

```{r upperquartile normalization}
library(edgeR)
merged_raw_data <- DGEList(merged_raw_data, group = colnames(merged_raw_data))
upperquartile <- calcNormFactors(merged_raw_data, method = "upperquartile")
upperquartile <- cpm(upperquartile, log=TRUE, normalized.lib.sizes = T)
head(upperquartile)

# Look at density plots
plotDensities(upperquartile, legend="topright")
```

## Correlation heatmap of log2upperquartile normalized and unfiltered samples

```{r corr heatmap unfiltered upperquartile}
cors <- cor(upperquartile, method="spearman", use="pairwise.complete.obs")

labels <- sapply(strsplit(colnames(merged_raw_data),"_"), `[`, 1)

heatmap.2( cors, scale="none", col = colors, margins = c(12, 12), trace='none', denscol="white", labCol=labels, ColSideColors=pal[as.integer(as.factor(labels))], RowSideColors=pal[as.integer(as.factor(labels))], cexCol = 0.2 + 1/log10(15), cexRow = 0.2 + 1/log10(15))
```

## Boxplots of upperquartile across samples

```{r boxplot upperquartile}
library(reshape2)
meltupperquartile <- melt(upperquartile)
names(meltupperquartile) <- c("gene", "sampleID", "upperquartile")
p <- ggplot(meltupperquartile, aes(factor(sampleID), upperquartile)) 
p + geom_boxplot() + theme(axis.text.x = element_text(angle = 90))
```

## Filtering for lowly expressed genes (avg log2upperquartile > 3 in at least 15 samples)

```{r filter upperquartile}
cutoff <- 3

keep <- rowSums( upperquartile > cutoff ) >= 15

counts_upperquartile <- merged_raw_data[keep,]
filtered_upperquartile <- upperquartile[keep,]
dim(filtered_upperquartile)
```

## Boxplots of normalized+filtered counts across samples

```{r boxplot filt upperquartile}
melt_filt_upperquartile <- melt(filtered_upperquartile)
names(melt_filt_upperquartile) <- c("gene", "sampleID", "log2upperquartile")
p1 <- ggplot(melt_filt_upperquartile, aes(factor(sampleID), log2upperquartile)) 
p1 + geom_boxplot() + theme(axis.text.x = element_text(angle = 90))

plotDensities(filtered_upperquartile, legend = F)
```

## Correlation heatmap of log2upperquartile normalized and filtered samples

```{r corr heatmap filtered upperquartile}
cors <- cor(filtered_upperquartile, method="spearman", use="pairwise.complete.obs")

labels <- sapply(strsplit(colnames(merged_raw_data),"_"), `[`, 1)

heatmap.2( cors, scale="none", col = colors, margins = c(12, 12), trace='none', denscol="white", labCol=labels, ColSideColors=pal[as.integer(as.factor(labels))], RowSideColors=pal[as.integer(as.factor(labels))], cexCol = 0.2 + 1/log10(15), cexRow = 0.2 + 1/log10(15))
```

## PCA of log2upperquartile normalized and filtered samples

```{r PCA quartile}
# Perform PCA
pca_genes <- prcomp(t(data.matrix(filtered_upperquartile)), scale = T)

#Make PCA plots 
autoplot(pca_genes, label = T)
```







## Normalize raw merged counts: RLE Normalization

```{r RLE normalization}
library(edgeR)
merged_raw_data <- DGEList(merged_raw_data, group = colnames(merged_raw_data))
RLE <- calcNormFactors(merged_raw_data, method = "RLE")
RLE <- cpm(RLE, log=TRUE, normalized.lib.sizes = T)
head(RLE)

# Look at density plots
plotDensities(RLE, legend="topright")
```

## Correlation heatmap of log2RLE normalized and unfiltered samples

```{r corr heatmap unfiltered RLE}
cors <- cor(RLE, method="spearman", use="pairwise.complete.obs")

labels <- sapply(strsplit(colnames(merged_raw_data),"_"), `[`, 1)

heatmap.2( cors, scale="none", col = colors, margins = c(12, 12), trace='none', denscol="white", labCol=labels, ColSideColors=pal[as.integer(as.factor(labels))], RowSideColors=pal[as.integer(as.factor(labels))], cexCol = 0.2 + 1/log10(15), cexRow = 0.2 + 1/log10(15))
```

## Boxplots of RLE across samples

```{r boxplot RLE}
library(reshape2)
meltRLE <- melt(RLE)
names(meltRLE) <- c("gene", "sampleID", "RLE")
p <- ggplot(meltRLE, aes(factor(sampleID), RLE)) 
p + geom_boxplot() + theme(axis.text.x = element_text(angle = 90))
```

## Filtering for lowly expressed genes (avg log2RLE > 3 in at least 15 samples)

```{r filter RLE}
cutoff <- 3

keep <- rowSums( RLE > cutoff ) >= 15

counts_RLE <- merged_raw_data[keep,]
filtered_RLE <- RLE[keep,]
dim(filtered_RLE)
```

## Boxplots of normalized+filtered counts across samples

```{r boxplot filt RLE}
melt_filt_RLE <- melt(filtered_RLE)
names(melt_filt_RLE) <- c("gene", "sampleID", "log2RLE")
p1 <- ggplot(melt_filt_RLE, aes(factor(sampleID), log2RLE)) 
p1 + geom_boxplot() + theme(axis.text.x = element_text(angle = 90))

plotDensities(filtered_RLE, legend = F)
```

## Correlation heatmap of log2RLE normalized and filtered samples

```{r corr heatmap filtered RLE}
cors <- cor(filtered_RLE, method="spearman", use="pairwise.complete.obs")

labels <- sapply(strsplit(colnames(merged_raw_data),"_"), `[`, 1)

heatmap.2( cors, scale="none", col = colors, margins = c(12, 12), trace='none', denscol="white", labCol=labels, ColSideColors=pal[as.integer(as.factor(labels))], RowSideColors=pal[as.integer(as.factor(labels))], cexCol = 0.2 + 1/log10(15), cexRow = 0.2 + 1/log10(15))
```

## PCA of log2RLE normalized and filtered samples

```{r PCA}
# Perform PCA
pca_genes <- prcomp(t(data.matrix(filtered_RLE)), scale = T)

#Make PCA plots 
autoplot(pca_genes, label = T)
```

# Grade of Membership analysis

```{r gom}
filtered_counts <- counts_upperquartile$counts
Combined_counts_celltypes <- sapply(strsplit(as.character(counts_upperquartile$samples$group),"_"), `[`, 1)

#Choosing between values of k
Combined_GoM <- CountClust::FitGoM(t(filtered_counts), K=c(3:20), tol = 0.1, control=list(tmax=100))
#choosing between k
comparisons <- compGoM(data = t(filtered_counts), model = Combined_GoM)
plot(cbind(comparisons[1,], c(3:20)))
plot(cbind(comparisons[2,], c(3:20)))
```


```{r plotting GoM}
plot_structure_plot <- function(omega, labels){
     annotation <- data.frame(
          sample_id = rownames(omega),
          tissue_label = labels
          )
     StructureGGplot(omega = omega,
                     annotation = annotation,
                     order_sample = TRUE,
                     axis_tick = list(axis_ticks_length = .1,
                                      axis_ticks_lwd_y = .1,
                                      axis_ticks_lwd_x = .1,
                                      axis_label_size = 7,
                                      axis_label_face = "bold")
                     )
     }


make_topic_plots <- function(omega, labels){
  omega <- as.data.frame(omega)
  omega <- cbind(omega,labels)
  for (k in 1:(ncol(omega)-1)) {
    base_plot <- ggplot(data = omega, mapping = aes(x = labels, y = omega[,k])) + labs(y = paste0("Topic ", k, " value"), x = paste0("Cell Type")) + theme(axis.text.x = element_text(angle = -20, hjust = 0, vjust = 0))
    plot(base_plot + geom_violin(width = 1.5, fill = "skyblue",color = "skyblue") +
      geom_boxplot(width = 0.1,outlier.shape = NA, alpha = 0.2))
   }
}

annotate_clusters <- function(theta_mat, countmatrix){
  top_features <- ExtractTopFeatures(theta_mat,
                                     top_features=100,
                                     method="poisson",
                                     options="min")
  gene_vector <- do.call(rbind, lapply(1:dim(top_features[[1]])[1], function(x) rownames(countmatrix)[top_features[[1]][x,]]))
  scores_vector <- do.call(rbind, lapply(1:dim(top_features[[1]])[1], function(x) top_features[[2]][x,]))
  return(list(gene_vector, scores_vector))
}


labels <- sapply(strsplit(colnames(merged_raw_data),"_"), `[`, 1)

# k = 3
#plot_structure_plot(omega = Combined_GoM$clust_3$omega, labels = labels)
make_topic_plots(omega = Combined_GoM$clust_3$omega, labels = labels)
genes <- annotate_clusters(theta_mat = Combined_GoM$clust_3$theta, countmatrix = filtered_counts)
matrix(gene_anno$external_gene_name[match(genes[[1]], gene_anno$ensembl_gene_id)], ncol = 100)
genes[[2]]

# k = 4
#plot_structure_plot(omega = Combined_GoM$clust_4$omega, labels = labels)
make_topic_plots(omega = Combined_GoM$clust_4$omega, labels = labels)
genes <- annotate_clusters(theta_mat = Combined_GoM$clust_4$theta, countmatrix = filtered_counts)
matrix(gene_anno$external_gene_name[match(genes[[1]], gene_anno$ensembl_gene_id)], ncol = 100)
genes[[2]]

# k = 5
#plot_structure_plot(omega = Combined_GoM$clust_5$omega, labels = labels)
make_topic_plots(omega = Combined_GoM$clust_5$omega, labels = labels)
genes <- annotate_clusters(theta_mat = Combined_GoM$clust_5$theta, countmatrix = filtered_counts)
matrix(gene_anno$external_gene_name[match(genes[[1]], gene_anno$ensembl_gene_id)], ncol = 100)
genes[[2]]

# k = 6
#plot_structure_plot(omega = Combined_GoM$clust_6$omega, labels = labels)
make_topic_plots(omega = Combined_GoM$clust_6$omega, labels = labels)
genes <- annotate_clusters(theta_mat = Combined_GoM$clust_6$theta, countmatrix = filtered_counts)
matrix(gene_anno$external_gene_name[match(genes[[1]], gene_anno$ensembl_gene_id)], ncol = 100)
genes[[2]]

# k = 7
#plot_structure_plot(omega = Combined_GoM$clust_7$omega, labels = labels)
make_topic_plots(omega = Combined_GoM$clust_7$omega, labels = labels)
genes <- annotate_clusters(theta_mat = Combined_GoM$clust_7$theta, countmatrix = filtered_counts)
matrix(gene_anno$external_gene_name[match(genes[[1]], gene_anno$ensembl_gene_id)], ncol = 100)
genes[[2]]

# k = 8
#plot_structure_plot(omega = Combined_GoM$clust_8$omega, labels = labels)
make_topic_plots(omega = Combined_GoM$clust_8$omega, labels = labels)
genes <- annotate_clusters(theta_mat = Combined_GoM$clust_8$theta, countmatrix = filtered_counts)
matrix(gene_anno$external_gene_name[match(genes[[1]], gene_anno$ensembl_gene_id)], ncol = 100)
genes[[2]]
```

# Check expression of chondrocyte markers across data

```{r chond markers}
#Inputs: count matrix, sample information data frame, and gene of interest in the ENSG format
get_gene_long <- function(counts, info, gene){
     gene_counts <- as.data.frame(counts[gene,])
     names(gene_counts) <- "norm_expr"
     gene_counts_info <- cbind(gene_counts, info)
     return(gene_counts_info)
}

boxplot_gene_sample_type <- function(counts_, info_, gene_, name, y_axis = "log2 Normalized Expression"){
     df <- get_gene_long(counts = counts_, info = info_, gene = gene_)
     
     ggplot(df, aes(x = labels, y = norm_expr, color = labels)) +
          geom_boxplot() +
          labs(title=paste0("Expression of ", as.character(name), " by sample type"), x= "Sample Type", y = y_axis)
}



labels <- sapply(strsplit(colnames(merged_raw_data),"_"), `[`, 1)

#SOX9
boxplot_gene_sample_type(filtered_RLE, labels, "ENSG00000125398", "SOX9")
#ACAN
boxplot_gene_sample_type(filtered_RLE, labels, "ENSG00000157766", "ACAN")
#COL11A1
boxplot_gene_sample_type(filtered_RLE, labels, "ENSG00000060718", "COL11A1")
#SOX5
boxplot_gene_sample_type(filtered_RLE, labels, "ENSG00000134532", "SOX5")
#SOX6
boxplot_gene_sample_type(filtered_RLE, labels, "ENSG00000110693", "SOX6")
#TGFB3
boxplot_gene_sample_type(filtered_RLE, labels, "ENSG00000119699", "TGFB3")

#COL2A1
boxplot_gene_sample_type(merged_raw_data$counts, labels, "ENSG00000139219", "COL2A1", y_axis = "Raw counts")

```

# Check expression of GoM cluster markers across data

For k = 4

```{r cluster markers}
# cluster 1

#COL3A1
boxplot_gene_sample_type(filtered_RLE, labels, "ENSG00000168542", "COL3A1")
#COL1A2
boxplot_gene_sample_type(filtered_RLE, labels, "ENSG00000164692", "COL1A2")
#COL1A1
boxplot_gene_sample_type(filtered_RLE, labels, "ENSG00000108821", "COL1A1")
#SPARC
boxplot_gene_sample_type(filtered_RLE, labels, "ENSG00000113140", "SPARC")
#FN1
boxplot_gene_sample_type(filtered_RLE, labels, "ENSG00000115414", "FN1")

# cluster 2

#IGFBP3
boxplot_gene_sample_type(filtered_RLE, labels, "ENSG00000146674", "IGFBP3")
#EFEMP1
boxplot_gene_sample_type(filtered_RLE, labels, "ENSG00000115380", "EFEMP1")
#BGN
boxplot_gene_sample_type(filtered_RLE, labels, "ENSG00000182492", "BGN")
#AHNAK
boxplot_gene_sample_type(filtered_RLE, labels, "ENSG00000124942", "AHNAK")
#HAPLN1
boxplot_gene_sample_type(filtered_RLE, labels, "ENSG00000145681", "HAPLN1")



# cluster 3

#SERPINA1
boxplot_gene_sample_type(filtered_RLE, labels, "ENSG00000197249", "SERPINA1")
#CTSV
boxplot_gene_sample_type(filtered_RLE, labels, "ENSG00000136943", "CTSV")
#KRT8
boxplot_gene_sample_type(filtered_RLE, labels, "ENSG00000170421", "KRT8")
#KRT19
boxplot_gene_sample_type(filtered_RLE, labels, "ENSG00000171345", "KRT19")
#APOE
boxplot_gene_sample_type(filtered_RLE, labels, "ENSG00000130203", "APOE")


# Cluster 4 (although is the representation of MT genes worrisome?)
#TTN
boxplot_gene_sample_type(filtered_RLE, labels, "ENSG00000155657", "TTN")
```






# Grade of Membership analysis after removing OA samples (because we were worried about these samples being potentially strange and clustering as an outgroup compared to all other samples)

```{r gom no OA}

filtered_counts <- counts_upperquartile$counts
filtered_counts <- filtered_counts[,-c(26, 29, 30, 32, 33, 38)]
labels <- sapply(strsplit(colnames(merged_raw_data),"_"), `[`, 1)
labels <- labels[-c(26, 29, 30, 32, 33, 38)]

#Choosing between values of k
Combined_GoM <- CountClust::FitGoM(t(filtered_counts), K=c(3:20), tol = 0.1, control=list(tmax=100))
#choosing between k
comparisons <- compGoM(data = t(filtered_counts), model = Combined_GoM)
plot(cbind(comparisons[1,], c(3:20)))
plot(cbind(comparisons[2,], c(3:20)))
```


```{r plotting GoM no OA}
# k = 3
#plot_structure_plot(omega = Combined_GoM$clust_3$omega, labels = labels)
make_topic_plots(omega = Combined_GoM$clust_3$omega, labels = labels)
genes <- annotate_clusters(theta_mat = Combined_GoM$clust_3$theta, countmatrix = filtered_counts)
matrix(gene_anno$external_gene_name[match(genes[[1]], gene_anno$ensembl_gene_id)], ncol = 100)
genes[[2]]

# k = 4
#plot_structure_plot(omega = Combined_GoM$clust_4$omega, labels = labels)
make_topic_plots(omega = Combined_GoM$clust_4$omega, labels = labels)
genes <- annotate_clusters(theta_mat = Combined_GoM$clust_4$theta, countmatrix = filtered_counts)
matrix(gene_anno$external_gene_name[match(genes[[1]], gene_anno$ensembl_gene_id)], ncol = 100)
genes[[2]]

# k = 5
#plot_structure_plot(omega = Combined_GoM$clust_5$omega, labels = labels)
make_topic_plots(omega = Combined_GoM$clust_5$omega, labels = labels)
genes <- annotate_clusters(theta_mat = Combined_GoM$clust_5$theta, countmatrix = filtered_counts)
matrix(gene_anno$external_gene_name[match(genes[[1]], gene_anno$ensembl_gene_id)], ncol = 100)
genes[[2]]

# k = 6
#plot_structure_plot(omega = Combined_GoM$clust_6$omega, labels = labels)
make_topic_plots(omega = Combined_GoM$clust_6$omega, labels = labels)
genes <- annotate_clusters(theta_mat = Combined_GoM$clust_6$theta, countmatrix = filtered_counts)
matrix(gene_anno$external_gene_name[match(genes[[1]], gene_anno$ensembl_gene_id)], ncol = 100)
genes[[2]]

# k = 7
#plot_structure_plot(omega = Combined_GoM$clust_7$omega, labels = labels)
make_topic_plots(omega = Combined_GoM$clust_7$omega, labels = labels)
genes <- annotate_clusters(theta_mat = Combined_GoM$clust_7$theta, countmatrix = filtered_counts)
matrix(gene_anno$external_gene_name[match(genes[[1]], gene_anno$ensembl_gene_id)], ncol = 100)
genes[[2]]

# k = 8
#plot_structure_plot(omega = Combined_GoM$clust_8$omega, labels = labels)
make_topic_plots(omega = Combined_GoM$clust_8$omega, labels = labels)
genes <- annotate_clusters(theta_mat = Combined_GoM$clust_8$theta, countmatrix = filtered_counts)
matrix(gene_anno$external_gene_name[match(genes[[1]], gene_anno$ensembl_gene_id)], ncol = 100)
genes[[2]]
```
